@model PedidoModel

@{
    ViewData["Title"] = "Detalle de la Compra";
}
<link href="~/css/CompraDetalle.css" rel="stylesheet" />

<div class="container mt-4">
    <h2 class="text-primary fw-bold">Detalle de la Compra</h2>

    <!-- Información general de la compra -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <p><strong>📅 Fecha:</strong> @Model.Fecha.ToString("dd 'de' MMMM yyyy")</p>
            <p><strong>🆔 Número de compra:</strong> @Model.Id</p>
            <p><strong>💰 Total:</strong> @Model.Total.ToString("C")</p>
        </div>
    </div>

    <!-- Lista de productos -->
    @if (Model.Detalles != null && Model.Detalles.Any())
    {
        <div class="row">
            @foreach (var producto in Model.Detalles)
            {
                // Verificamos si la imagen viene nula o vacía
                var imagen = string.IsNullOrEmpty(producto.UrlImagen)
                ? Url.Content("~/Produimage/sin-imagen.png")   // imagen por defecto
                : (producto.UrlImagen.StartsWith("/")
                ? Url.Content(producto.UrlImagen)          // ya viene con ruta absoluta (/Produimage/xxx.png)
                : Url.Content("~/Produimage/" + producto.UrlImagen)); // solo nombre (xxx.png)

                <div class="col-md-6 mb-3">
                    <div class="card h-100 shadow-sm">
                        <div class="row g-0">
                            <div class="col-4">
                                <img src="@imagen"
                                     alt="@producto.Nombre"
                                     class="img-fluid rounded-start"
                                     style="width:100%;height:120px;object-fit:cover;" />
                            </div>
                            <div class="col-8">
                                <div class="card-body">
                                    <h6 class="card-title fw-bold">@producto.Nombre</h6>
                                    <p class="card-text mb-1">
                                        Cantidad: <span class="fw-bold">@producto.Cantidad</span>
                                    </p>
                                    <p class="card-text mb-1">
                                        Precio unitario: @producto.PrecioUnitario.ToString("C")
                                    </p>
                                    <p class="card-text fw-bold">
                                        Subtotal: @producto.Subtotal.ToString("C")
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="alert alert-info text-center">
            Esta compra no tiene productos asociados 🛒
        </div>
    }

    <!-- Botones de acción -->
    <div class="mt-4 d-flex gap-2">
        <a asp-action="Compras" class="btn btn-secondary">⬅ Volver a mis compras</a>
        <a asp-action="RepetirCompra" asp-route-id="@Model.Id" class="btn btn-primary">🔄 Volver a comprar</a>
        <a asp-action="GenerarFactura" asp-route-id="@Model.Id" class="btn btn-success">📄 Generar Factura</a>
    </div>
</div>
